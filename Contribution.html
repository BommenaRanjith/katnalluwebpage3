<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Contribute</title>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<style>
body { font-family:Arial; background:#fff3e0; }
.card { width:420px; margin:40px auto; background:#fff; padding:20px; border-radius:16px; }
img { width:100%; border-radius:12px; }
.gift { display:flex; justify-content:space-between; margin:10px 0; }
button { background:#ff9800; color:#fff; border:none; padding:6px 12px; border-radius:6px; }
progress { width:100%; }
</style>
</head>

<body>
<div class="card" id="app">Loading...</div>

<script>
const supabase = supabase.createClient(
  "https://jdzerwfwrsctemjwxqru.supabase.co",
  "PASTE_YOUR_PUBLISHABLE_KEY_HERE"
);

const id = new URLSearchParams(location.search).get("id");

async function load(){
  const { data: celebration } = await supabase
    .from("celebrations")
    .select("*")
    .eq("id", id)
    .single();

  const { data: gifts } = await supabase
    .from("gifts")
    .select("*")
    .eq("celebration_id", id);

  let html = `
    <h2>${celebration.occasion}</h2>
    <p>${celebration.event_date}</p>
    <img src="${celebration.image_url}">
  `;

  gifts.forEach(g=>{
    html += `
      <div class="gift">
        <div>
          <b>${g.name}</b><br>
          ₹${g.collected || 0} / ₹${g.amount}
          <progress value="${g.collected || 0}" max="${g.amount}"></progress>
        </div>
        <button onclick="pay('${celebration.upi}',${g.amount})">Contribute</button>
      </div>
    `;
  });

  document.getElementById("app").innerHTML = html;
}

function pay(upi, amount){
  location.href = `upi://pay?pa=${upi}&am=${amount}&cu=INR`;
}

load();
</script>
</body>
</html>
